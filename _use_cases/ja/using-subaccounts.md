---
title:  Subaccounts APIを使用する

products: account/subaccounts

description:  このトピックでは、Subaccounts APIの使用を開始する方法のケーススタディを紹介します。

languages:
  - Curl
*** ** * ** ***
Subaccounts APIを使用する
====================
概要
---
このトピックでは、パートナーがSubaccounts APIを使用してエンドカスタマーを正常に管理するユースケースについて説明します。
準備
---
Subaccounts APIに関する[主要概念](/account/subaccounts/overview)を理解している必要があります。
サブアカウントを作成する
------------
パートナーは、エンドカスタマーごとにサブアカウントの作成を決定します。そのため、エンドカスタマーごとに異なるAPI認証情報を使用して、エンドカスタマーの支出を確認できます。これを図で説明すると、次のようになります。
![共有残高を持つサブアカウント](/images/subaccounts/shared_balance.png)
サブアカウントを作成するには、次のコードが使用できます。
```code_snippets
source: '_examples/subaccounts/create-subaccount'
```
クレジットを転送する
----------
パートナーは全員が同じ残高を共有していたため、エンドカスタマー間の支出を管理できませんでした。あるエンドカスタマーは、他のパートナーのエンドカスタマーがVonage APIにアクセスするのを効果的にブロックするため、すべての共有残高を消費することがありました。パートナーは、個々の残高を設定し、そのエンドカスタマーに与信限度額を割り当てることにしました。

> **注** ：パートナーはアカウントを前払いにすることもできました。
各サブアカウントには、次の図に示すように、個々の残高と与信限度額を割り当てることができます。
![クレジットの配分](/images/subaccounts/credit_allocation.png)
次のコードスニペットは、指定されたクレジット額をサブアカウントに割り当てることを説明しています。
```code_snippets
source: '_examples/subaccounts/transfer-credit'
```
すべてのサブアカウントの残高を確認する
-------------------
パートナーは、監視を実施することを決定しました。次のコードスニペットを使用して、すべてのサブアカウントの残高を定期的に確認できます。
```code_snippets
source: '_examples/subaccounts/get-subaccounts'
```
追加クレジットの配分
----------
しばらくすると、パートナーは、エンドカスタマー1（サブアカウント1）がそのクレジット（40のうち40）をすべて使い切ってしまい、これ以上のAPI呼び出しを実行できないことに気づきました。パートナーは、エンドカスタマー1が支払いを行うのを待つか（その後、Vonageに支払いを行い、対応する残高をサブアカウントに転送する）、またはエンドカスタマー1がVonage APIの使用を継続できるように、エンドカスタマー1の与信限度額を直ちに増加させるかのいずれかを選択しなければなりませんでした。パートナーは、追加のクレジットを配分することにしました。パートナーは40 = |-60| - |-20|の利用可能なクレジットを持っており、20をサブアカウントに配分することにしました。これを図で説明すると、次のようになります。
![追加クレジット](/images/subaccounts/additional_credit_allocation.png)
月末の残高振替
-------
月末に、パートナーはVonageから|-20| \+ |-50| = 70ユーロの請求書を受け取りました（すべてのアカウントからの支出に対して）。エンドカスタマー1（サブアカウント1）は、使用した50ユーロのうち45ユーロをカバーしていました。したがって、パートナーは45ユーロをサブアカウント1の残高に振り込みました。これを図で説明すると、次のようになります。
![追加クレジット](/images/subaccounts/month_end_balance_transfer.png)
以下のコードは、残高をサブアカウントに転送する方法を示しています。
```code_snippets
source: '_examples/subaccounts/transfer-balance'
```
サブアカウントを一時的に停止する
----------------
パートナーは、サブアカウントの支出を制御する機能を気に入り、エンドカスタマー2（サブアカウント2）に個々の残高と30ユーロのクレジットを割り当てることにしました。サブアカウントの支出を監視していたパートナーは、サブアカウント2が残高の25ユーロを消費していることに気づきました。サブアカウント2の支出率に警戒したパートナーは、サブアカウント2を一時的に停止することにしました。サブアカウントを一時的に停止するコードは次のようになります。
```code_snippets
source: '_examples/subaccounts/suspend-subaccount'
```
サブアカウントを再有効化する
--------------
パートナーは、サブアカウント2と協議し、サブアカウント2のアカウントを再有効化することを決定しました。これは、以下のコードを使用して実現できます。
```code_snippets
source: '_examples/subaccounts/reactivate-subaccount'
```
まとめ
---
このトピックでは、エンドカスタマーを管理するためにSubaccounts APIを使用する方法を、典型的なシナリオで説明しました。
その他のリソース

---

* [基本概念](/account/subaccounts/overview)
* [コードスニペット](/account/subaccounts/code-snippets/create-subaccount)
* [API 情報](/api/subaccounts)

